<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Home | MetroShare</title>
        <link href="css/style.css" type="text/css" rel="stylesheet">
        <link href="css/font-awesome.min.css" type="text/css" rel="stylesheet">
        <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
        <script type="text/javascript" src="JS/Utils.js"></script>
        <link rel="shortcut icon" type="image/x-icon" href="images/favicon.ico">
    </head>
    <body>

        <div class="container-fluid navbar-dropdown-toggle-container visible-mobile">
            <a href="#" class="navbar-dropdown-toggle"><i class="fa fa-2x fa-bars"></i></a>
        </div>

        <div class="container-fluid">
            <div class="navbar-secondary visible-desktop">
                <div class="container">
                    <ul>
                        <li class="left navbar-secondary-logo"><a href="index.html"><img src="images/favicon.ico" alt=""></a></li>
                        <li class="left"><a href="statistics.html">Statistics</a></li>
                        <li class="left"><a href="about.html">About</a></li>
                        <li class="right login-area">
                            <form class="signin-form" method="post" onsubmit="onSignIn(event);">
                                <input type="text" name="username" placeholder="Username" required>
                                <input type="password" name="password" placeholder="Password" required>
                                <input type="submit" value="Log in">
                            </form>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container-fluid navbar-secondary-container">
            <div class="container">
                <div class="navbar visible-desktop" id="navbar-desktop">
                    <ul>
                        <li><a href="index.html"><i class="fa fa-home"></i>Home</a></li>
                        <li><a href="browse.html"><i class="fa fa-search"></i>Browse</a></li>
                        <li><a href="upload.html"><i class="fa fa-upload"></i>Upload</a></li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="navbar visible-mobile" id="navbar-mobile">
            <div class="container">
                <ul>
                    <li><a href="index.html"><i class="fa fa-home"></i>Home</a></li>
                    <li><a href="browse.html"><i class="fa fa-search"></i>Browse</a></li>
                    <li><a href="upload.html"><i class="fa fa-upload"></i>Upload</a></li>
                </ul>
            </div>
        </div>

        <div class="container-fluid" style="background: url(http://i.imgur.com/yTWY6ay.jpg) no-repeat center center; color:#ffffff;">
            <div class="container search-media">
                <div class="col-12">
                    <form id="search-media" method="post" action="" style="margin-top: 25px; white-space: nowrap;">
                        <input type="text" name="search" placeholder="Search">
                        <button type="submit" class="redbtn redbtn-search"><i class="fa fa-search"></i></button>
                        <ul>
                            <li><label class="checkbox"><input type="checkbox" id="titles" value="true" checked class="checked"><span></span></label>Titles</li>
                            <li><label class="checkbox"><input type="checkbox" id="users" value="true" checked class="checked"><span></span></label>Users</li>
                            <li><label class="checkbox"><input type="checkbox" id="tags" value="true" checked class="checked"><span></span></label>Tags</li>
                        </ul>
                    </form>
                </div>
            </div>
        </div>

        <div class="container-fluid" id="latest-media-container">
            <div class="col-12">
                <h1 id="latest-media-headin">N Latest Medias</h1>
            </div>  
        </div>
        <div id="latest-media" class="container-fluid media-container search-results">
        </div>

        <div class="container-fluid">
            <div class="col-12">
                <h1 id="random-media-headin">N TOP PICTURES OF THE DAY</h1>
            </div>
        </div>
        <div id="random-media" class="container-fluid media-container">
        </div>

        <footer class="container-fluid">
            <div class="container">
                <ul class="col-4">
                    <li><a href="index.html">Home</a></li>
                    <li><a href="about.html">About</a></li>
                </ul>

                <ul class="col-4">
                    <li><a href="browse.html">Browse</a></li>
                    <li><a href="upload.html">Upload</a></li>
                </ul>

                <ul class="col-4">
                    <li><a href="statistics.html">Statistics</a></li>
                    <li><a href="signup.html">Sign up</a></li>
                </ul>
            </div>
        </footer>

        <script type="text/javascript">
            $(document).ready(function (event) {
                var loc = document.location.toString();
                var qparamsl = readQParamsToList(loc);
                console.log(qparamsl);

                var tag = returnValueOf(qparamsl, "tag");
                var user = returnValueOf(qparamsl, "user");
                var title = returnValueOf(qparamsl, "title");
                var search = returnValueOf(qparamsl, "search");

                if (!tag && !title && !user) {
                    tag = true;
                    user = true;
                    title = true;
                }

                if (title == null) {
                    $("#titles").toggleClass("checked");
                    $("#titles").removeAttr("checked");
                }
                if (!user) {
                    $("#users").toggleClass("checked");
                    $("#users").removeAttr("checked");
                }
                if (!tag) {
                    $("#tags").toggleClass("checked");
                    $("#tags").removeAttr("checked");
                }

                if (search != null) {
                    console.log(search);
                    $.ajax({
                        type: "GET",
                        url: "http://localhost:8080/MetroShare/webresources/media/search/" + search,
                        success: function (data, textStatus, xhr) {
                            //alert(data);
                            var jsondata = JSON.parse(data);

                            var searchResults = document.querySelector("#latest-media-container");
                            searchResults.innerHTML = "";
                            var mediacontainer = document.createElement("div");
                            mediacontainer.setAttribute("class", "container-fluid");

                            if (jsondata[0].length < 1 && jsondata[1].length < 1 && jsondata[2].length < 1) {
                                var col12 = document.createElement("div");
                                col12.setAttribute("class", "col-12");
                                var h1 = document.createElement("h1");
                                h1.innerHTML = "No media found!";
                                col12.append(h1);
                                mediacontainer.append(col12);
                            }

                            if (jsondata[0].length > 0 && title) {
                                var col12 = document.createElement("div");
                                col12.setAttribute("class", "col-12");
                                var h1 = document.createElement("h1");
                                h1.innerHTML = jsondata[0].length + " found by media title";
                                col12.append(h1);
                                mediacontainer.append(col12);
                                // Adding Media found by title
                                for (i = 0; i < jsondata[0].length; i++) {
                                    mediacontainer.append(generateMedia(jsondata[0][i]));
                                }
                            }

                            if (jsondata[1].length > 0 && user) {
                                console.log("by uploader");
                                var col12 = document.createElement("div");
                                col12.setAttribute("class", "col-12");
                                var h1 = document.createElement("h1");
                                h1.innerHTML = jsondata[1].length + " found by uploaders user name";
                                col12.append(h1);
                                mediacontainer.append(col12);
                                // Adding Media found by uploader login name
                                for (i = 0; i < jsondata[1].length; i++) {
                                    mediacontainer.append(generateMedia(jsondata[1][i]));
                                }
                            }

                            if (jsondata[2].length > 0 && tag) {
                                var col12 = document.createElement("div");
                                col12.setAttribute("class", "col-12");
                                var h1 = document.createElement("h1");
                                h1.innerHTML = jsondata[2].length + " found by tag";
                                col12.append(h1);
                                mediacontainer.append(col12);
                                // Adding Media found by tag
                                for (i = 0; i < jsondata[2].length; i++) {
                                    mediacontainer.append(generateMedia(jsondata[2][i]));
                                }
                            }
                            searchResults.append(mediacontainer);
                        },
                        error: function (jqXHR, textStatus, errorThrown) {
                            console.log("Error: " + errorThrown);
                        }
                    });
                }
            });
        </script>


        <script type="text/javascript">
            //give class "checked" to checkbox when clicking on its span
            $('span').click(function (event) {
                $(this).parents("label").find("input").toggleClass("checked");
            });
        </script>

        <script type="text/javascript">
            $("#search-media").submit(function (event) {
                event.preventDefault();
                $.ajax({
                    type: "POST",
                    url: "http://localhost:8080/MetroShare/webresources/media/search/",
                    data: $("#search-media").serialize(),
                    success: function (data, textStatus, xhr) {
                        //alert(data);
                        var jsondata = JSON.parse(data);
                        //alert(jsondata[0]);
                        //alert(jsondata[1]);
                        //alert(jsondata[2]);

                        var searchResults = document.querySelector(".search-results");
                        searchResults.innerHTML = "";
                        if (jsondata[0].length < 1 && jsondata[1].length < 1 && jsondata[2].length < 1) {
                            var col12 = document.createElement("div");
                            col12.setAttribute("class", "col-12");
                            var h1 = document.createElement("h1");
                            h1.innerHTML = "No media found!";
                            col12.append(h1);
                            searchResults.append(col12);
                        }

                        if (jsondata[0].length > 0 && $("#titles").hasClass("checked")) {
                            var col12 = document.createElement("div");
                            col12.setAttribute("class", "col-12");
                            var h1 = document.createElement("h1");
                            h1.innerHTML = jsondata[0].length + " found by media title";
                            col12.append(h1);
                            searchResults.append(col12);
                            // Adding Media found by title
                            for (i = 0; i < jsondata[0].length; i++) {
                                searchResults.append(generateMedia(jsondata[0][i]));
                            }
                        }

                        if (jsondata[1].length > 0 && $("#users").hasClass("checked")) {
                            console.log("by uploader");
                            var col12 = document.createElement("div");
                            col12.setAttribute("class", "col-12");
                            var h1 = document.createElement("h1");
                            h1.innerHTML = jsondata[1].length + " found by uploaders user name";
                            col12.append(h1);
                            searchResults.append(col12);
                            // Adding Media found by uploader login name
                            for (i = 0; i < jsondata[1].length; i++) {
                                searchResults.append(generateMedia(jsondata[1][i]));
                            }
                        }

                        if (jsondata[2].length > 0 && $("#tags").hasClass("checked")) {
                            var col12 = document.createElement("div");
                            col12.setAttribute("class", "col-12");
                            var h1 = document.createElement("h1");
                            h1.innerHTML = jsondata[2].length + " found by tag";
                            col12.append(h1);
                            searchResults.append(col12);
                            // Adding Media found by tag
                            for (i = 0; i < jsondata[2].length; i++) {
                                searchResults.append(generateMedia(jsondata[2][i]));
                            }
                        }

                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        console.log("Error: " + errorThrown);
                    }
                });
                $("#latest-media-headin").remove();
            }
            );
        </script>

        <script type="text/javascript">
            $(document).ready(function (event) {
                $.ajax({
                    type: "GET",
                    url: "http://localhost:8080/MetroShare/webresources/media/get/8",
                    success: function (data, textStatus, xhr) {
                        var jsondata = JSON.parse(data);
                        //console.log(jsondata[0]);

                        var headin = jsondata.length + " random media of the moment";
                        document.querySelector("#random-media-headin").innerHTML = headin;
                        // Random media
                        for (i = 0; i < jsondata.length; i++) {
                            document.querySelector("#random-media").append(generateMedia(jsondata[i])); // where to
                        }
                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        console.log("Error: " + errorThrown);
                    }
                });
            });
        </script>

        <script type="text/javascript">
            $(document).ready(function (event) {
                $.ajax({
                    type: "GET",
                    url: "http://localhost:8080/MetroShare/webresources/media/latest/8",
                    success: function (data, textStatus, xhr) {
                        var jsondata = JSON.parse(data);
                        console.log(jsondata[0]);
                        var headin = jsondata.length + " Latest media";
                        document.querySelector("#latest-media-headin").innerHTML = headin;
                        // Adding latest media
                        for (i = 0; i < jsondata.length; i++) {
                            document.querySelector("#latest-media").append(generateMedia(jsondata[i])); // where to
                        }
                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        console.log("Error: " + errorThrown);
                    }
                });
            });
        </script>
    </body>
</html>
