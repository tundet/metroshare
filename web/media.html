<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Home | MetroShare</title>
        <link href="css/style.css" type="text/css" rel="stylesheet">
        <link href="css/font-awesome.min.css" type="text/css" rel="stylesheet">
        <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
        <script type="text/javascript" src="JS/Utils.js"></script>
        <link rel="shortcut icon" type="image/x-icon" href="images/favicon.ico">
    </head>
    <body>

        <div class="container-fluid navbar-dropdown-toggle-container visible-mobile">
            <a href="#" class="navbar-dropdown-toggle"><i class="fa fa-2x fa-bars"></i></a>
        </div>

        <div class="container-fluid">
            <div class="navbar-secondary visible-desktop">
                <div class="container">
                    <ul>
                        <li class="left navbar-secondary-logo"><a href="index.html"><img src="images/favicon.ico" alt=""></a>
                        </li>
                        <li class="left"><a href="index.html">Statistics</a></li>
                        <li class="left"><a href="index.html">About</a></li>
                        <li class="right">
                            <form class="signin-form" method="post" onsubmit="onSignIn(event);">
                                <input type="text" name="username" placeholder="Username" required>
                                <input type="password" name="password" placeholder="Password" required>
                                <input type="submit" value="Log in">
                            </form>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container-fluid navbar-secondary-container">
            <div class="container">
                <div class="navbar visible-desktop" id="navbar-desktop">
                    <ul>
                        <li><a href="index.html"><i class="fa fa-home"></i>Home</a></li>
                        <li><a href="browse.html"><i class="fa fa-search"></i>Browse</a></li>
                        <li><a href="upload.html"><i class="fa fa-upload"></i>Upload</a></li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="navbar visible-mobile" id="navbar-mobile">
            <div class="container">
                <ul>
                    <li><a href="index.html"><i class="fa fa-home"></i>Home</a></li>
                    <li><a href="browse.html"><i class="fa fa-search"></i>Browse</a></li>
                    <li><a href="upload.html"><i class="fa fa-upload"></i>Upload</a></li>
                </ul>
            </div>
        </div>

        <div class="container-fluid">
            <div class="container-fluid">
                <div class="container browse-media-container">
                    <div class="col-12">
                        <h3 class="img-title">Title</h3>
                        <figure class="show-media-figure">
                            <img src="http://nemanjakovacevic.net/wp-content/uploads/2013/07/placeholder.png" alt="{{ mediaTitle }}">
                            <figcaption>{{ mediaTitle }}</figcaption>
                        </figure>
                    </div>
                </div>
            </div>

            <div class="container">
                <div class="col-12 comments">
                </div>
            </div>

            <footer class="container-fluid">
                <div class="container">
                    <ul class="col-4">
                        <li><a href="#">Home</a></li>
                        <li><a href="#">Browse</a></li>
                        <li><a href="#">Upload</a></li>
                        <li><a href="#">About</a></li>
                    </ul>

                    <ul class="col-4">
                        <li><a href="#">Home</a></li>
                        <li><a href="#">Browse</a></li>
                        <li><a href="#">Upload</a></li>
                        <li><a href="#">About</a></li>
                    </ul>

                    <ul class="col-4">
                        <li><a href="#">Home</a></li>
                        <li><a href="#">Browse</a></li>
                        <li><a href="#">Upload</a></li>
                        <li><a href="#">About</a></li>
                    </ul>
                </div>
            </footer>
        </div>

        <script type="text/javascript">
            $(document).ready(function (event) {
                var loc = document.location.toString();
                loc = loc.substring(loc.indexOf("?") + 1);
                var qparam = loc.split("=")
                console.log(qparam);
                $.ajax({
                    type: "GET",
                    url: "http://localhost:8080/MetroShare/webresources/media/" + qparam[1],
                    success: function (data, textStatus, xhr) {
                        var jsondata = JSON.parse(data);
                        var a = [];
                        var b = [];
                        for (var data in jsondata[0]) {
                            b.push(data);
                        }
                        a.push(b);
                        for (var json in jsondata) {
                            var b = [];
                            for (var data in jsondata[json]) {
                                b.push(jsondata[json][data]);
                            }
                            a.push(b);
                        }

                        console.log(a);

                        // make media title
                        var title = $(".img-title");
                        title.text(a[1][3]);

                        // make media figure
                        var figure = $(".show-media-figure");
                        figure.text("");
                        var img = document.createElement("img");
                        img.alt = a[1][3];
                        // TODO real image path
                        //console.log("/images" + a[1][2]);
                        //img.src = "http://nemanjakovacevic.net/wp-content/uploads/2013/07/placeholder.png";
                        img.src = a[1][2];
                        figure.append(img);

                        var figcaption = document.createElement("figcaption");
                        //figcaption.innerHTML = a[1][3];
                        for (i in a[1][6]) {
                            var tag = document.createElement("a");
                            tag.href = "browse.html?tag=1&search=" + a[1][6][i].tag;
                            tag.innerHTML = "#" + a[1][6][i].tag;
                            figcaption.append(tag);
                        }
                        figure.append(figcaption);

                        var comments = $(".comments");

                        // comment make area
                        var LOGINNAME = checkIfLoggedIn().username;
                        if (LOGINNAME != null) {
                            console.log("Logged in as " + LOGINNAME);
                            var makeCommentDiv = document.createElement("div");
                            var commentForm = document.createElement("form");
                            
                            var sender = document.createElement("input");
                            sender.type = "hidden";
                            sender.value = readSessionIdFromCookie();
                            commentForm.append(sender);
                            
                            var commentText = document.createElement("textarea");
                            commentText.rows = "2";
                            commentText.name = "comment";
                            commentText.placeholder = "Type comment here!";
                            commentText.maxlength = "255";
                            commentText.autofocus = "autofocus";
                            commentText.required = "required";
                            commentText.wrap = "soft";
                            commentForm.append(commentText);
                            
                            var summaryDiv = document.createElement("div");
                            summaryDiv.classList.add("comment-summary");
                            
                            var aRules = document.createElement("a");
                            aRules.href = "#";
                            aRules.innerHTML = "Remember community rules";
                            summaryDiv.append(aRules);
                            
                            var sendButton = document.createElement("button");
                            sendButton.type = "submit";
                            sendButton.classList.add("redbtn");
                            sendButton.classList.add("redbtn-search");
                            sendButton.innerHTML = "<i class=\"fa fa-commenting-o\"></i>";
                            summaryDiv.append(sendButton);
                            commentForm.append(summaryDiv);
                            
                            makeCommentDiv.append(commentForm);
                            comments.append(makeCommentDiv);
                        }
                        
                        console.log(a[1][5].length)
                        if (a[1][5].length > 0) {
                            for (i in a[1][5]) {
                                console.log(a[1][5][i].date);
                                var contdiv = document.createElement("div");
                                contdiv.classList.add("comment");

                                var leftColumn = document.createElement("div");
                                leftColumn.classList.add("col-3");
                                contdiv.append(leftColumn);

                                var rightColumn = document.createElement("div");
                                rightColumn.classList.add("col-9");
                                contdiv.append(rightColumn);

                                var unameh2 = document.createElement("h2");
                                unameh2.innerHTML = a[1][5][i].userName;
                                leftColumn.append(unameh2);

                                var datespan = document.createElement("span");
                                datespan.classList.add("comment-date");
                                datespan.innerHTML = a[1][5][i].date;
                                leftColumn.append(datespan);

                                var messagep = document.createElement("p");
                                messagep.classList.add("comment-message");
                                messagep.innerHTML = a[1][5][i].message;
                                rightColumn.append(messagep);

                                comments.append(contdiv);
                            }
                        } else {
                            var h2 = document.createElement("h2");
                            h2.innerHTML = "No comments yet!";
                            comments.append(h2);
                        }
                        
                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        console.log("Error: " + errorThrown);
                    }
                });
            });
        </script>

        <script type="text/javascript">
            function arrayToTable(arrayToBeTable) {
                // console.log(arrayToBeTable);
                var table = document.getElementById("tables");
                table.innerHTML = '';
                var thead = document.createElement("THEAD");
                var tbody = document.createElement("TBODY");
                var tr = document.createElement("TR");
                for (i = 0; i < arrayToBeTable.length; i++) {
                    if (i == 0) {
                        for (var header in arrayToBeTable[i]) {
                            var th = document.createElement("TH");
                            th.textContent = arrayToBeTable[i][header];
                            tr.appendChild(th);
                        }
                        thead.appendChild(tr);
                        table.appendChild(thead);
                    } else {
                        tr = document.createElement("TR");
                        for (var value in arrayToBeTable[i]) {
                            var th = document.createElement("TD");
                            th.textContent = arrayToBeTable[i][value];
                            tr.appendChild(th);
                        }
                        tbody.appendChild(tr);
                        table.appendChild(tbody);
                    }
                }
            }
        </script>
    </body>
</html>
